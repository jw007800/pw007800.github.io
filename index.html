<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="IT_金乌's Blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="Blog - 宋杰的实验室">
<meta property="og:type" content="website">
<meta property="og:title" content="IT_金乌's Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="IT_金乌's Blog">
<meta property="og:description" content="Blog - 宋杰的实验室">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="IT_金乌's Blog">
<meta name="twitter:description" content="Blog - 宋杰的实验室">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title> IT_金乌's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">IT_金乌's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle"></p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            履历
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/07/runloop/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="songjie">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/6276527?v=3&s=400">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="IT_金乌's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="IT_金乌's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/07/runloop/" itemprop="url">
                  runloop
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-07T15:34:41+08:00">
                2017-02-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/IOS/" itemprop="url" rel="index">
                    <span itemprop="name">IOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>用简洁易懂的语言归纳runLoop和对我们日常开发的影响。</p>
</blockquote>
<h3 id="RunLoop概述"><a href="#RunLoop概述" class="headerlink" title="RunLoop概述"></a>RunLoop概述</h3><p>一般来讲，一个线程一次只能执行一个任务，执行完成后线程就会退出。如果我们需要一个机制，让线程能随时处理事件但并不退出，通常的代码逻辑是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">function loop() &#123;</div><div class="line">    initialize();</div><div class="line">    do &#123;</div><div class="line">        var message = get_next_message();</div><div class="line">        process_message(message);</div><div class="line">    &#125; while (message != quit);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>runLoop是一个与线程相关的机制，可以简单理解为一个循环。 在这个循环里面等待事件，然后处理事件。而这个循环是基于线程的。 在Cocoa中每个线程都有它的runLoop. 通过runLoop这样的机制，线程能够在没有事件需要处理的时候休息，有事情的时候运行。减轻CPU压力。</p>
<p>所以，RunLoop 实际上就是一个对象，这个对象管理了其需要处理的事件和消息，并提供了一个入口函数来执行上面 Event Loop 的逻辑。线程执行了这个函数后，就会一直处于这个函数内部 “接受消息-&gt;等待-&gt;处理” 的循环中，直到这个循环结束（比如传入 quit 的消息），函数返回。</p>
<h3 id="特征"><a href="#特征" class="headerlink" title="特征"></a>特征</h3><ol>
<li><p>每个线程都有一个Run Loop，主线程的Run Loop会在App运行时自动运行，子线程中需要手动运行。</p>
</li>
<li><p>每个Run Loop都会以一个模式mode来运行，可以使用NSRunLoop的- (BOOL)runMode:(NSString <em>)mode beforeDate:(NSDate </em>)limitDate 方法运行在某个特定模式mode。</p>
</li>
<li><p>Run Loop的处理两大类事件源：Timer Source和Input Source(包括performSelector*方法簇、Port或者自定义Input Source)，每个事件源都会绑定在Run Loop的某个特定模式mode上，而且只有RunLoop在这个模式运行的时候才会触发该Timer和Input Source。</p>
</li>
<li><p>如果没有任何事件源添加到Run Loop上，Run Loop就会立刻exit。</p>
</li>
</ol>
<h3 id="Run-Loop接口"><a href="#Run-Loop接口" class="headerlink" title="Run Loop接口"></a>Run Loop接口</h3><p>要操作Run Loop，Foundation层和Core Foundation层都有对应的接口可以操作Run Loop。</p>
<p>Foundation层对应的是NSRunLoop:</p>
<img src="/2017/02/07/runloop/NSRunLoop.jpg" alt="NSRunLoop.jpg" title="">
<p>Core Foundation层对应的是CFRunLoopRef：</p>
<img src="/2017/02/07/runloop/CFRunLoopRef.jpg" alt="CFRunLoopRef.jpg" title="">
<p>两组接口差不多，不过功能上还是有许多区别的，例如CF层可以添加自定义Input Source事件源(CFRunLoopSourceRef)和Run Loop观察者Observer(CFRunLoopObserverRef)，很多类似功能的接口特性也是不一样的。</p>
<h3 id="RunLoop运行"><a href="#RunLoop运行" class="headerlink" title="RunLoop运行"></a>RunLoop运行</h3><p>Run Loop如何运行呢,再看一例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">- (void)main</div><div class="line">&#123;</div><div class="line">    @autoreleasepool &#123;</div><div class="line">        NSLog(@&quot;starting thread.......&quot;);</div><div class="line">        NSTimer *timer = [NSTimer timerWithTimeInterval:2 target:self selector:@selector(doTimerTask) userInfo:nil repeats:YES];</div><div class="line">        [[NSRunLoop currentRunLoop] addTimer:timer forMode:NSDefaultRunLoopMode];</div><div class="line">        [timer release];</div><div class="line">        while (! self.isCancelled) &#123;</div><div class="line">            [self doOtherTask];</div><div class="line">            BOOL ret = [[NSRunLoop currentRunLoop] runMode:NSDefaultRunLoopMode beforeDate:[NSDate distantFuture]];</div><div class="line">            NSLog(@&quot;after runloop counting.........: %d&quot;, ret);</div><div class="line">        &#125;</div><div class="line">        NSLog(@&quot;finishing thread.........&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)doTimerTask</div><div class="line">&#123;</div><div class="line">    NSLog(@&quot;do timer task&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)doOtherTask</div><div class="line">&#123;</div><div class="line">    NSLog(@&quot;do other task&quot;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>我们看到入口方法里创建了一个NSTimer，并且以NSDefaultRunLoopMode模式加入到当前子线程的NSRunLoop中。进入循环后肯定会执行-doOtherTask方式法一次，然后再以NSDefaultRunLoopMode模式运行NSRunLoop，如果一次Timer事件触发处理后，这个Run Loop会返回吗？答案是不会，Why？</p>
<p>NSRunLoop的底层是由CFRunLoopRef实现的，你可以想象成一个循环或者类似Linux下select或者epoll，当没有事件触发时，你调用的Run Loop运行方法不会立刻返回，它会持续监听其他事件源，如果需要Run Loop会让子线程进入sleep等待状态而不是空转，只有当Timer Source或者Input Source事件发生时，子线程才会被唤醒，然后处理触发的事件，然而由于Timer source比较特殊，Timer Source事件发生处理后，Run Loop运行方法- (BOOL)runMode:(NSString <em>)mode beforeDate:(NSDate </em>)limitDate;也不会返回；而其他非Timer事件的触发处理会让这个Run Loop退出并返回YES。当Run Loop运行在一个特定模式时，如果该模式下没有事件源，运行Run Loop会立刻返回NO。</p>
<p><strong>NSRunLoop的运行接口：</strong></p>
<pre>
//运行 NSRunLoop，运行模式为默认的NSDefaultRunLoopMode模式，没有超时限制
- (void)run;

//运行 NSRunLoop: 参数为运行模式、时间期限，返回值为YES表示是处理事件后返回的，NO表示是超时或者停止运行导致返回的
- (BOOL)runMode:(NSString *)mode beforeDate:(NSDate *)limitDate;

//运行 NSRunLoop: 参数为运时间期限，运行模式为默认的NSDefaultRunLoopMode模式
-(void)runUntilDate:(NSDate *)limitDate;
</pre>

<blockquote>
<p>CFRunLoopRef的运行接口：</p>
</blockquote>
<p><pre><br>//运行 CFRunLoopRef<br>void CFRunLoopRun();</pre></p>
<p>//运行 CFRunLoopRef: 参数为运行模式、时间和是否在处理Input Source后退出标志，返回值是exit原因<br>SInt32 CFRunLoopRunInMode (mode, seconds, returnAfterSourceHandled);</p>
<p>//停止运行 CFRunLoopRef<br>void CFRunLoopStop( CFRunLoopRef rl );</p>
<p>//唤醒 CFRunLoopRef<br>void CFRunLoopWakeUp ( CFRunLoopRef rl );<br><br>详细讲解下NSRunLoop的三个运行接口：</p>
<ul>
<li><code>- (void)run; 无条件运行</code></li>
</ul>
<p>不建议使用，因为这个接口会导致Run Loop永久性的运行在<code>NSDefaultRunLoopMode</code>模式，即使使用<code>CFRunLoopStop(runloopRef)</code>;也无法停止<code>Run Loop的运行</code>，那么这个子线程就无法停止，只能永久运行下去。</p>
<ul>
<li><code>- (void)runUntilDate:(NSDate *)limitDate; 有一个超时时间限制</code></li>
</ul>
<p>比上面的接口好点，有个超时时间，可以控制每次Run Loop的运行时间，也是运行在<code>NSDefaultRunLoopMode</code>模式。这个方法运行Run Loop一段时间会退出给你检查运行条件的机会，如果需要可以再次运行Run Loop。注意<code>CFRunLoopStop(runloopRef)</code>;也无法停止Run Loop的运行，因此最好自己设置一个合理的Run Loop运行时间。示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">BOOL Done = NO;</div><div class="line">while (!Done)  </div><div class="line">&#123;</div><div class="line">    [[NSRunLoop currentRunLoop] runUntilDate:[NSDate</div><div class="line">                dateWithTimeIntervalSinceNow:10]];</div><div class="line">    NSLog(@&quot;exiting runloop.........:&quot;);</div><div class="line">    Done = YES;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li><code>- (BOOL)runMode:(NSString *)mode beforeDate:(NSDate *)limitDate; 有一个超时时间限制，而且设置运行模式</code></li>
</ul>
<p>这个接口在非Timer事件触发、显式的用CFRunLoopStop停止Run Loop、到达limitDate后会退出返回。如果仅是Timer事件触发并不会让Run Loop退出返回；如果是PerfromSelector*事件或者其他Input Source事件触发处理后，Run Loop会退出返回YES。示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">while (!Done)  </div><div class="line">&#123;</div><div class="line">    BOOL ret = [[NSRunLoop currentRunLoop] runMode:NSDefaultRunLoopMode</div><div class="line">                                        beforeDate:[NSDate distantFuture]];</div><div class="line">    NSLog(@&quot;exiting runloop.........: %d&quot;, ret);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>那么如何知道一个Run Loop是因为什么原因exit退出的呢？NSRunLoop中没有接口可以知道，而需要通过Core Foundation的接口来运行CFRunLoopRef，NSRunLoop其实就是CFRunLoopRef的二次封装。使用CFRunLoop的接口(C的接口)来运行Run Loop，有两个接口：</p>
<ul>
<li><code>void CFRunLoopRun(void);</code></li>
</ul>
<p>运行在默认的kCFRunLoopDefaultMode模式下，直到使用CFRunLoopStop接口停止这个Run Loop，或者Run Loop的所有事件源都被删除。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">while (!self.isCancelled)  </div><div class="line">&#123;</div><div class="line">    [self doOtherTask];</div><div class="line"></div><div class="line">    SInt32 result = CFRunLoopRunInMode(kCFRunLoopDefaultMode, 2, YES);</div><div class="line">    if (result == kCFRunLoopRunStopped)</div><div class="line">    &#123;</div><div class="line">        [self cancel];</div><div class="line">    &#125;</div><div class="line">    NSLog(@&quot;exit run loop.........: %ld&quot;, result);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果Run Loop退出返回后，返回值是SInt32类型(signed long)，表明Run Loop返回的原因，目前有四种：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">enum &#123;  </div><div class="line">    kCFRunLoopRunFinished = 1, //Run Loop结束，没有Timer或者其他Input Source</div><div class="line">    kCFRunLoopRunStopped = 2, //Run Loop被停止，使用CFRunLoopStop停止Run Loop</div><div class="line">    kCFRunLoopRunTimedOut = 3, //Run Loop超时</div><div class="line">    kCFRunLoopRunHandledSource = 4 ////Run Loop处理完事件，注意Timer事件的触发是不会让Run Loop退出返回的，即使CFRunLoopRunInMode的第三个参数是YES也不行</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>注意：Run Loop是可以嵌套调用的(就像NSAutoreleasePool)，例如一个Run Loop运行过程中一个事件触发后，那么在触发方法里可以再运行当前子线程的Run Loop，然后由这个Run Loop等待其他事件触发。不过这种嵌套Run Loop调用方式我用的比较少。</p>
<p>以上Run Loop运行方法参考本文最后的Sample Code自行尝试。</p>
<h3 id="RunLoop的运行模式Mode"><a href="#RunLoop的运行模式Mode" class="headerlink" title="RunLoop的运行模式Mode"></a>RunLoop的运行模式Mode</h3><p>iOS下Run Loop的主要运行模式mode有：</p>
<p>iOS下Run Loop的主要运行模式mode有：</p>
<p>1) NSDefaultRunLoopMode: 默认的运行模式，除了NSConnection对象的事件。</p>
<p>2) NSRunLoopCommonModes: 是一组常用的模式集合，将一个input source关联到这个模式集合上，等于将input source关联到这个模式集合中的所有模式上。在iOS系统中NSRunLoopCommonMode包含NSDefaultRunLoopMode、NSTaskDeathCheckMode、UITrackingRunLoopMode，我有个timer要关联到这些模式上，一个个注册很麻烦，我可以用CFRunLoopAddCommonMode([[NSRunLoop currentRunLoop] getCFRunLoop],(__bridge CFStringRef) NSEventTrackingRunLoopMode)将NSEventTrackingRunLoopMode或者其他模式添加到这个NSRunLoopCommonModes模式中，然后只需要将Timer关联到NSRunLoopCommonModes，即可以实现Run Loop运行在这个模式集合中任何一个模式时，这个Timer都可以被触发。默认情况下NSRunLoopCommonModes包含了NSDefaultRunLoopMode和UITrackingRunLoopMode。注意：让Run Loop运行在NSRunLoopCommonModes下是没有意义的，因为一个时刻Run Loop只能运行在一个特定模式下，而不可能是个模式集合。</p>
<p>3) UITrackingRunLoopMode: 用于跟踪触摸事件触发的模式（例如UIScrollView上下滚动），主线程当触摸事件触发时会设置为这个模式，可以用来在控件事件触发过程中设置Timer。</p>
<p>4) GSEventReceiveRunLoopMode: 用于接受系统事件，属于内部的Run Loop模式。</p>
<p>5) 自定义Mode：可以设置自定义的运行模式Mode，你也可以用CFRunLoopAddCommonMode添加到NSRunLoopCommonModes中。</p>
<p>Run Loop运行时只能以一种固定的模式运行，只会监控这个模式下添加的Timer Source和Input Source，如果这个模式下没有相应的事件源，Run Loop的运行也会立刻返回的。注意Run Loop不能在运行在NSRunLoopCommonModes模式，因为NSRunLoopCommonModes其实是个模式集合，而不是一个具体的模式，我可以在添加事件源的时候使用NSRunLoopCommonModes，只要Run Loop运行在NSRunLoopCommonModes中任何一个模式，这个事件源都可以被触发。</p>
<h3 id="RunLoop的事件源"><a href="#RunLoop的事件源" class="headerlink" title="RunLoop的事件源"></a>RunLoop的事件源</h3><p>归根结底，Run Loop就是个处理事件的Loop，可以添加Timer和其他Input Source等各种事件源，如果事件源没有发生时，Run Loop就可能让线程进入asleep状态，而事件源发生时就会唤醒休眠的(asleep)的子线程来处理事件。Run Loop的事件源事件源分两类：Timer Source和Input Source(包括-performSelector:*API调用簇，Port Input Source、自定义Input Source)。</p>
<img src="/2017/02/07/runloop/runloop_source.jpg" alt="runloop_source.jpg" title="">
<p>从上图可以看出Run Loop就是处理事件的一个循环，不同的是Timer Source事件处理后不会使Run Loop结束，而Input Source事件处理后会让Run Loop退出。因此你需要自己的一个Loop去不断运行Run Loop来处理事件，就像本文开头的示例那样。</p>
<p>细分下Run Loop的事件源：</p>
<p>1) Timer Souce就是创建Timer添加到Run Loop中，没啥好说的，Cocoa或者Core Foundation都有相应接口实现。需要注意的是scheduledTimerWith<em>**</em>开头生成的Timer会自动帮你以默认NSDefaultRunLoopMode模式加载到当前的Run Loop中，而其他接口生成的Timer则需要你手动使用-addTimer:forMode添加到Run Loop中。需要额外注意的是Timer的触发不会让Run Loop返回。(Timer sources deliver events to their handler routines but do not cause the run loop to exit.) 具体实验可以看下面的Sample Code。</p>
<p>2) Input Source中的-performSelector:*API调用簇方法，有以下这些接口：</p>
<p><pre><br>performSelectorOnMainThread:withObject:waitUntilDone:<br>performSelectorOnMainThread:withObject:waitUntilDone:modes:</pre></p>
<p>performSelector:onThread:withObject:waitUntilDone:<br>performSelector:onThread:withObject:waitUntilDone:modes:</p>
<p>performSelector:withObject:afterDelay:<br>performSelector:withObject:afterDelay:inModes:</p>
<p>cancelPreviousPerformRequestsWithTarget:<br>cancelPreviousPerformRequestsWithTarget:selector:object:<br><br>这些API最后两个是取消当前线程中调用，其他API是在主线程或者当前线程下的Run Loop中执行指定的@selector。</p>
<p>3) Port Input Source：概念上也比较简单，可以用NSMachPort作为线程之间的通讯通道。例如在主线程创建子线程时传入一个NSPort对象，这样主线程就可以和这个子线程通讯啦，如果要实现双向通讯，那么子线程也需要回传给主线程一个NSPort。</p>
<p>NSPort的子类除了NSMachPort，还可以使用NSMessagePort或者Core Foundation中的CFMessagePortRef。</p>
<blockquote>
<p>注意：虽然有这么棒的方式实现线程间通讯方式，但是估计是由于危及iOS的Sandbox沙盒环境，所以这些API都是私有接口，如果你用到NSPortMessage，XCode会提示’NSPortMessage’ for instance message is a forward declaration。</p>
</blockquote>
<p>4) 自定义Input Source：</p>
<p>向Run Loop添加自定义Input Source只能使用Core Foundation的接口：CFRunLoopSourceCreate创建一个source，CFRunLoopAddSource向Run Loop中添加source，CFRunLoopRemoveSource从Run Loop中删除source，CFRunLoopSourceSignal通知source，CFRunLoopWakeUp唤醒Run Loop。</p>
<p>Apple官方文档提供了一个自定义Input Source使用模式。</p>
<img src="/2017/02/07/runloop/input_source.jpg" alt="input_source.jpg" title="">
<p>主线程持有包含子线程的Run Loop和Source的context对象，还有一个用于保存需要运行操作的数据buffer。主线程需要子线程干活时，首先将需要的操作数据添加到数据buffer，然后通知source，唤醒子线程Run Loop（因为子线程可能正在sleep状态，CFRunLoopWakeUp唤醒Run Loop可以通知线程醒来干活），由于子线程也持有这个source和数据buffer，因此在触发唤醒时可以使用这个数据buffer的数据来执行相关操作（需要注意数据buffer访问时的同步）。</p>
<h3 id="RunLoop的Observer"><a href="#RunLoop的Observer" class="headerlink" title="RunLoop的Observer"></a>RunLoop的Observer</h3><p>Core Foundation层的接口可以定义一个Run Loop的观察者在Run Loop进入以下某个状态时得到通知：</p>
<ul>
<li>Run loop的进入</li>
<li>Run loop处理一个Timer的时刻</li>
<li>Run loop处理一个Input Source的时刻</li>
<li>Run loop进入睡眠的时刻</li>
<li>Run loop被唤醒的时刻，但在唤醒它的事件被处理之前</li>
<li>Run loop的终止</li>
</ul>
<p>首先创建Observer的context，然后调用Core Foundation方法CFRunLoopObserverCreate创建Observer，再加入到当前线程的Run Loop中，注意CFRunLoopObserverCreate方法的第二个参数是Observer观察类型，有如下几种<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">typedef CF_OPTIONS(CFOptionFlags, CFRunLoopActivity) &#123;</div><div class="line">    kCFRunLoopEntry         = (1UL &lt;&lt; 0), // 即将进入Loop</div><div class="line">    kCFRunLoopBeforeTimers  = (1UL &lt;&lt; 1), // 即将处理 Timer</div><div class="line">    kCFRunLoopBeforeSources = (1UL &lt;&lt; 2), // 即将处理 Source</div><div class="line">    kCFRunLoopBeforeWaiting = (1UL &lt;&lt; 5), // 即将进入休眠</div><div class="line">    kCFRunLoopAfterWaiting  = (1UL &lt;&lt; 6), // 刚从休眠中唤醒</div><div class="line">    kCFRunLoopExit          = (1UL &lt;&lt; 7), // 即将退出Loop</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>Observer的创建以及添加到Run Loop中需要使用Core Foundation的接口：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">CFRunLoopObserverContext  context = &#123;0, (__bridge void *)(self), NULL, NULL, NULL&#125;;  </div><div class="line">CFRunLoopObserverRef observer = CFRunLoopObserverCreate(kCFAllocatorDefault, kCFRunLoopBeforeTimers, YES, 0, &amp;myRunLoopObserver, &amp;context);  </div><div class="line">if (observer)  </div><div class="line">&#123;</div><div class="line">    CFRunLoopAddObserver(CFRunLoopGetCurrent(), observer,</div><div class="line">                                 kCFRunLoopCommonModes);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>Run Loop就是一个处理事件源的循环，你可以控制这个Run Loop运行多久，如果当前没有事件发生，Run Loop会让这个线程进入睡眠状态(避免再浪费CPU时间)，如果有事件发生，Run Loop就处理这个事件。Run Loop处理事件和发送给Observer通知的流程如下：</p>
<ol>
<li>进入Run Loop运行，此时会通知观察者进入Run Loop；</li>
<li>如果有Timer即将触发时，通知观察者；</li>
<li>如果有非Port的Input Sourc即将e触发时，通知观察者；</li>
<li>触发非Port的Input Source事件源；</li>
<li>如果基于Port的Input Source事件源即将触发时，立即处理该事件，跳转到步骤9；</li>
<li>通知观察者当前线程将进入休眠状态；</li>
<li>将线程进入休眠状态直到有以下事件发生：基于Port的Input Source被触发、Timer被触发、Run Loop运行时间到了过期时间、Run Loop被唤醒。</li>
<li>通知观察者线程将要被唤醒。</li>
<li>处理被触发的事件：<blockquote>
<p>如果是用户自定义的Timer，处理Timer事件后重新启动Run Loop进入步骤2；<br>如果线程被唤醒又没有到过期时间，则进入步骤2；<br>如果是其他Input Source事件源有事件发生，直接处理这个事件；</p>
</blockquote>
</li>
<li>到达此步骤说明Run Loop运行时间到期，或者是非Timer的Input Source事件被处理后，Run Loop将要退出，退出前通知观察者线程已退出。<br>什么时候需要用到Run Loop？官方文档的建议是：</li>
</ol>
<p>需要使用Port或者自定义Input Source与其他线程进行通讯。</p>
<p>需要在线程中使用Timer。</p>
<p>需要在线程上使用performSelector*方法。</p>
<p>需要让线程执行周期性的工作。</p>
<p>我个人在开发中遇到的需要使用Run Loop的情况有：</p>
<p>使用自定义Input Source和其他线程通信</p>
<p>子线程中使用了定时器</p>
<p>使用任何performSelector*到子线程中运行方法</p>
<p>使用子线程去执行周期性任务</p>
<p>NSURLConnection在子线程中发起异步请求</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/01/CocoaPods之制作篇/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="songjie">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/6276527?v=3&s=400">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="IT_金乌's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="IT_金乌's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/01/CocoaPods之制作篇/" itemprop="url">
                  CocoaPods之制作篇
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-01T22:15:17+08:00">
                2017-02-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/集成/" itemprop="url" rel="index">
                    <span itemprop="name">集成</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>学会使用别人的Pods依赖库以后，你一定对创建自己的依赖库跃跃欲试，今天就来揭开Pods依赖库创建过程的神秘面纱</strong></p>
<h3 id="创建自己的github仓库"><a href="#创建自己的github仓库" class="headerlink" title="创建自己的github仓库"></a>创建自己的github仓库</h3><p><strong><a href="https://github.com" target="_blank" rel="external">https://github.com</a></strong><br></p>
<ol>
<li>登陆github.</li>
<li>New repository</li>
</ol>
<img src="/2017/02/01/CocoaPods之制作篇/20140304200447379.jpg" alt="20140304200447379.jpg" title="">
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="number">1</span>、Repository name 仓库名称，这里写成WZMarqueeView，必填的</div><div class="line"><span class="number">2</span>、Description 仓库的描述信息，可选的</div><div class="line"><span class="number">3</span>、仓库的公开性 这里只能选Public，一个是因为Private是要<span class="section">money</span>的，再一个Private别人看不到还共享个毛</div><div class="line"><span class="number">4</span>、是否创建一个默认的README文件 一个完整地仓库，都需要README说明文档，建议选上。当然不嫌麻烦的话你也可以后面再手动创建一个</div><div class="line"><span class="number">5</span>、是否添加.gitignore文件 .gitignore文件里面记录了若干中文件类型，凡是该文件包含的文件类型，git都不会将其纳入到版本管理中。是否选择看个人需要</div><div class="line"><span class="number">6</span>、license类型 正规的仓库都应该有一个license文件，Pods依赖库对这个文件的要求更严，是必须要有的。因此最好在这里让github创建一个，也可以自己后续再创建。我使用的license类型是MIT</div></pre></td></tr></table></figure>
<img src="/2017/02/01/CocoaPods之制作篇/20140304200447380.jpg" alt="20140304200447380.jpg" title="">
<p>到这，仓库创建过程就结束了。</p>
<hr>
<h3 id="clone仓库到本地"><a href="#clone仓库到本地" class="headerlink" title="clone仓库到本地"></a>clone仓库到本地</h3><ol>
<li>点击 Clone in Desktop （建议安装 github Desktop MAC 客户端）</li>
<li>默认应该有 README.md 文件</li>
</ol>
<h3 id="添加-podspec文件"><a href="#添加-podspec文件" class="headerlink" title="添加.podspec文件"></a>添加.podspec文件</h3><ol>
<li>podspec文件的制作。ruby 格式 和 json格式</li>
<li>默认应该有 README.md 文件</li>
<li>copy 与 pod spec create your_pod_spec_name (反正我是copy后直接改)</li>
<li><a href="http://iiiyu.com/2013/03/01/learning-ios-notes-sixteen/" target="_blank" rel="external">@参考</a></li>
</ol>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Be sure to run `pod spec lint SIStore.podspec' to ensure this is a</span></div><div class="line"><span class="comment"># valid spec.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Remove all comments before submitting the spec. Optional attributes are commented.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># For details see: https://github.com/CocoaPods/CocoaPods/wiki/The-podspec-format</span></div><div class="line"><span class="comment">#</span></div><div class="line">Pod::Spec.new do |s|</div><div class="line">  s.<span class="attr">name</span>         = <span class="string">"SIStore"</span></div><div class="line">  s.<span class="attr">version</span>      = <span class="string">"0.0.1"</span></div><div class="line">  s.<span class="attr">summary</span>      = <span class="string">"A short description of SIStore."</span></div><div class="line">  <span class="comment"># s.description  = &lt;&lt;-DESC</span></div><div class="line">  <span class="comment">#                   An optional longer description of SIStore</span></div><div class="line">  <span class="comment">#</span></div><div class="line">  <span class="comment">#                   * Markdown format.</span></div><div class="line">  <span class="comment">#                   * Don't worry about the indent, we strip it!</span></div><div class="line">  <span class="comment">#                  DESC</span></div><div class="line">  s.<span class="attr">homepage</span>     = <span class="string">"http://EXAMPLE/SIStore"</span></div><div class="line">  <span class="comment"># Specify the license type. CocoaPods detects automatically the license file if it is named</span></div><div class="line">  <span class="comment"># `LICEN&#123;C,S&#125;E*.*', however if the name is different, specify it.</span></div><div class="line">  s.<span class="attr">license</span>      = 'MIT (example)'</div><div class="line">  <span class="comment"># s.license      = &#123; :type =&gt; 'MIT (example)', :file =&gt; 'FILE_LICENSE' &#125;</span></div><div class="line">  <span class="comment">#</span></div><div class="line">  <span class="comment"># Only if no dedicated file is available include the full text of the license.</span></div><div class="line">  <span class="comment">#</span></div><div class="line">  <span class="comment"># s.license      = &#123;</span></div><div class="line">  <span class="comment">#   :type =&gt; 'MIT (example)',</span></div><div class="line">  <span class="comment">#   :text =&gt; &lt;&lt;-LICENSE</span></div><div class="line">  <span class="comment">#             Copyright (C) &lt;year&gt; &lt;copyright holders&gt;</span></div><div class="line">  <span class="comment">#             All rights reserved.</span></div><div class="line">  <span class="comment">#             Redistribution and use in source and binary forms, with or without</span></div><div class="line">  <span class="comment">#             ...</span></div><div class="line">  <span class="comment">#   LICENSE</span></div><div class="line">  <span class="comment"># &#125;</span></div><div class="line">  <span class="comment"># Specify the authors of the library, with email addresses. You can often find</span></div><div class="line">  <span class="comment"># the email addresses of the authors by using the SCM log. E.g. $ git log</span></div><div class="line">  <span class="comment">#</span></div><div class="line">  s.<span class="attr">author</span>       = &#123; <span class="string">"Xiao ChenYu"</span> =&gt; <span class="string">"apple.iiiyu@gmail.com"</span> &#125;</div><div class="line">  <span class="comment"># s.authors      = &#123; "Xiao ChenYu" =&gt; "apple.iiiyu@gmail.com", "other author" =&gt; "and email address" &#125;</span></div><div class="line">  <span class="comment">#</span></div><div class="line">  <span class="comment"># If absolutely no email addresses are available, then you can use this form instead.</span></div><div class="line">  <span class="comment">#</span></div><div class="line">  <span class="comment"># s.author       = 'Xiao ChenYu', 'other author'</span></div><div class="line">  <span class="comment"># Specify the location from where the source should be retrieved.</span></div><div class="line">  <span class="comment">#</span></div><div class="line">  s.<span class="attr">source</span>       = &#123; :<span class="attr">git</span> =&gt; <span class="string">"http://EXAMPLE/SIStore.git"</span>, :<span class="attr">tag</span> =&gt; <span class="string">"0.0.1"</span> &#125;</div><div class="line">  <span class="comment"># s.source       = &#123; :svn =&gt; 'http://EXAMPLE/SIStore/tags/1.0.0' &#125;</span></div><div class="line">  <span class="comment"># s.source       = &#123; :hg  =&gt; 'http://EXAMPLE/SIStore', :revision =&gt; '1.0.0' &#125;</span></div><div class="line">  <span class="comment"># If this Pod runs only on iOS or OS X, then specify the platform and</span></div><div class="line">  <span class="comment"># the deployment target.</span></div><div class="line">  <span class="comment">#</span></div><div class="line">  <span class="comment"># s.platform     = :ios, '5.0'</span></div><div class="line">  <span class="comment"># s.platform     = :ios</span></div><div class="line">  <span class="comment"># ――― MULTI-PLATFORM VALUES ――――――――――――――――――――――――――――――――――――――――――――――――― #</span></div><div class="line">  <span class="comment"># If this Pod runs on both platforms, then specify the deployment</span></div><div class="line">  <span class="comment"># targets.</span></div><div class="line">  <span class="comment">#</span></div><div class="line">  <span class="comment"># s.ios.deployment_target = '5.0'</span></div><div class="line">  <span class="comment"># s.osx.deployment_target = '10.7'</span></div><div class="line">  <span class="comment"># A list of file patterns which select the source files that should be</span></div><div class="line">  <span class="comment"># added to the Pods project. If the pattern is a directory then the</span></div><div class="line">  <span class="comment"># path will automatically have '*.&#123;h,m,mm,c,cpp&#125;' appended.</span></div><div class="line">  <span class="comment">#</span></div><div class="line">  <span class="comment"># Alternatively, you can use the FileList class for even more control</span></div><div class="line">  <span class="comment"># over the selected files.</span></div><div class="line">  <span class="comment"># (See http://rake.rubyforge.org/classes/Rake/FileList.html.)</span></div><div class="line">  <span class="comment">#</span></div><div class="line">  s.<span class="attr">source_files</span> = 'Classes', 'Classes<span class="comment">/**/</span>*.&#123;h,m&#125;'</div><div class="line">  <span class="comment"># A list of file patterns which select the header files that should be</span></div><div class="line">  <span class="comment"># made available to the application. If the pattern is a directory then the</span></div><div class="line">  <span class="comment"># path will automatically have '*.h' appended.</span></div><div class="line">  <span class="comment">#</span></div><div class="line">  <span class="comment"># Also allows the use of the FileList class like `source_files' does.</span></div><div class="line">  <span class="comment">#</span></div><div class="line">  <span class="comment"># If you do not explicitly set the list of public header files,</span></div><div class="line">  <span class="comment"># all headers of source_files will be made public.</span></div><div class="line">  <span class="comment">#</span></div><div class="line">  <span class="comment"># s.public_header_files = 'Classes/**/*.h'</span></div><div class="line">  <span class="comment"># A list of resources included with the Pod. These are copied into the</span></div><div class="line">  <span class="comment"># target bundle with a build phase script.</span></div><div class="line">  <span class="comment">#</span></div><div class="line">  <span class="comment"># Also allows the use of the FileList class like `source_files' does.</span></div><div class="line">  <span class="comment">#</span></div><div class="line">  <span class="comment"># s.resource  = "icon.png"</span></div><div class="line">  <span class="comment"># s.resources = "Resources/*.png"</span></div><div class="line">  <span class="comment"># A list of paths to preserve after installing the Pod.</span></div><div class="line">  <span class="comment"># CocoaPods cleans by default any file that is not used.</span></div><div class="line">  <span class="comment"># Please don't include documentation, example, and test files.</span></div><div class="line">  <span class="comment"># Also allows the use of the FileList class like `source_files' does.</span></div><div class="line">  <span class="comment">#</span></div><div class="line">  <span class="comment"># s.preserve_paths = "FilesToSave", "MoreFilesToSave"</span></div><div class="line">  <span class="comment"># Specify a list of frameworks that the application needs to link</span></div><div class="line">  <span class="comment"># against for this Pod to work.</span></div><div class="line">  <span class="comment">#</span></div><div class="line">  <span class="comment"># s.framework  = 'SomeFramework'</span></div><div class="line">  <span class="comment"># s.frameworks = 'SomeFramework', 'AnotherFramework'</span></div><div class="line">  <span class="comment"># Specify a list of libraries that the application needs to link</span></div><div class="line">  <span class="comment"># against for this Pod to work.</span></div><div class="line">  <span class="comment">#</span></div><div class="line">  <span class="comment"># s.library   = 'iconv'</span></div><div class="line">  <span class="comment"># s.libraries = 'iconv', 'xml2'</span></div><div class="line">  <span class="comment"># If this Pod uses ARC, specify it like so.</span></div><div class="line">  <span class="comment">#</span></div><div class="line">  <span class="comment"># s.requires_arc = true</span></div><div class="line">  <span class="comment"># If you need to specify any other build settings, add them to the</span></div><div class="line">  <span class="comment"># xcconfig hash.</span></div><div class="line">  <span class="comment">#</span></div><div class="line">  <span class="comment"># s.xcconfig = &#123; 'HEADER_SEARCH_PATHS' =&gt; '$(SDKROOT)/usr/include/libxml2' &#125;</span></div><div class="line">  <span class="comment"># Finally, specify any Pods that this Pod depends on.</span></div><div class="line">  <span class="comment">#</span></div><div class="line">  <span class="comment"># s.dependency 'JSONKit', '~&gt; 1.4'</span></div><div class="line">end</div></pre></td></tr></table></figure>
<h4 id="去掉注释-ruby-格式"><a href="#去掉注释-ruby-格式" class="headerlink" title="去掉注释 ruby 格式"></a>去掉注释 ruby 格式</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">Pod::Spec.new <span class="keyword">do</span> <span class="params">|s|</span></div><div class="line">  s.name         = <span class="string">"SIStore"</span> <span class="comment">#声明库的名称</span></div><div class="line">  s.version      = <span class="string">"0.0.2"</span>   <span class="comment"># 库的版本</span></div><div class="line">  s.summary      = <span class="string">"Sumi Interactive make a new CoreData and iCloud a "</span> <span class="comment">#一个简短的说明文档</span></div><div class="line">  s.homepage     = <span class="string">"http://iiiyu.com"</span> <span class="comment">#库的首页</span></div><div class="line">  s.license      = <span class="string">'MIT'</span> <span class="comment">#库的协议</span></div><div class="line">  s.author       = &#123; <span class="string">"Xiao ChenYu"</span> =&gt; <span class="string">"apple.iiiyu@gmail.com"</span> &#125; <span class="comment">#作者</span></div><div class="line">  s.source       = &#123; <span class="symbol">:git</span> =&gt; <span class="string">"https://iiiyu@bitbucket.org/iiiyu/sistore.git"</span>, <span class="symbol">:tag</span> =&gt; <span class="string">"0.0.2"</span> &#125; <span class="comment">#原代码的地址</span></div><div class="line">  s.source_files = <span class="string">'SIStore/*.&#123;h,m&#125;'</span> <span class="comment">#原代码的目录</span></div><div class="line">  s.preserve_paths  = <span class="string">'SIStoreDemo'</span></div><div class="line">  s.resources    = <span class="string">'SIStore/SIStore.bundle'</span></div><div class="line">  s.framework    = <span class="string">'CoreData'</span> <span class="comment">#需要依赖的系统库</span></div><div class="line">  s.dependency <span class="string">'MagicalRecord'</span>, <span class="symbol">:git</span> =&gt; <span class="string">'https://github.com/iiiyu/MagicalRecord.git'</span>, <span class="symbol">:tag</span> =&gt; <span class="string">'sumiGridDiary2.1'</span></div><div class="line">  s.dependency <span class="string">'SVProgressHUD'</span> <span class="comment">#需要依赖的第三方</span></div><div class="line">  s.requires_arc = <span class="literal">true</span>        <span class="comment">#是否开启arc</span></div><div class="line">  s.platform     = <span class="symbol">:ios</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<h4 id="josn格式"><a href="#josn格式" class="headerlink" title="josn格式"></a>josn格式</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"name"</span>: <span class="string">"SIStore"</span>,</div><div class="line">    <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</div><div class="line">    <span class="attr">"summary"</span>: <span class="string">"A short description of EFJoymeAd."</span>,</div><div class="line">    <span class="attr">"authors"</span>: &#123;</div><div class="line">        <span class="attr">"antonyzhao"</span>: <span class="string">"antonyzhao@staff.joyme.com"</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"source"</span>: &#123;</div><div class="line">        <span class="attr">"git"</span>: <span class="string">"https://iiiyu@bitbucket.org/iiiyu/sistore.git"</span>,</div><div class="line">        <span class="attr">"tag"</span>: <span class="string">"1.0.0"</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"requires_arc"</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">"platforms"</span>: &#123;</div><div class="line">        <span class="attr">"ios"</span>: <span class="string">"6.0"</span>,</div><div class="line">        <span class="attr">"osx"</span>: <span class="string">"10.8"</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"public_header_files"</span>: <span class="string">"Pod/Classes/**/*.h"</span>,</div><div class="line">    <span class="attr">"source_files"</span>: <span class="string">"Pod/Classes/**/*.&#123;h,m&#125;"</span>,</div><div class="line">    <span class="attr">"resources"</span>: <span class="string">"Pod/Assets/**/*.*"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong> 通配符说明</strong> <br><br><code>a{bb,bc}def.{h,m}表示四个文件abbdef.h abbdef.m abcdef.h abcdef.m</code><br><br><code>*.{h,m,mm}表示所有的.h .m .mm文件</code> <br><br><code>*.{h,m,mm}表示所有的.h .m .mm文件</code> <br><br><code>Class/**/*.{h,m}表示Class目录下的所有.h .m文件</code> <br></p>
<h3 id="添加LICENSE文件"><a href="#添加LICENSE文件" class="headerlink" title="添加LICENSE文件"></a>添加LICENSE文件</h3><p><strong>copy一个放进到目录就可以了</strong><br></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">The MIT License (MIT)</div><div class="line"></div><div class="line">Copyright (c) 2013 shu223</div><div class="line"></div><div class="line">Permission is hereby granted, free of charge, to any person obtaining a copy of</div><div class="line">this software and associated documentation files (the "Software"), to deal in</div><div class="line">the Software without restriction, including without limitation the rights to</div><div class="line"><span class="keyword">use</span>, copy, <span class="keyword">modify</span>, <span class="keyword">merge</span>, publish, <span class="keyword">distribute</span>, sublicense, <span class="keyword">and</span>/<span class="keyword">or</span> sell copies <span class="keyword">of</span></div><div class="line">the Software, <span class="keyword">and</span> <span class="keyword">to</span> permit persons <span class="keyword">to</span> whom the Software <span class="keyword">is</span> furnished <span class="keyword">to</span> <span class="keyword">do</span> so,</div><div class="line">subject <span class="keyword">to</span> the <span class="keyword">following</span> conditions:</div><div class="line"></div><div class="line">The above copyright <span class="keyword">notice</span> <span class="keyword">and</span> this permission <span class="keyword">notice</span> shall be included <span class="keyword">in</span> all</div><div class="line">copies <span class="keyword">or</span> substantial portions <span class="keyword">of</span> the Software.</div><div class="line"></div><div class="line">THE SOFTWARE <span class="keyword">IS</span> PROVIDED <span class="string">"AS IS"</span>, <span class="keyword">WITHOUT</span> WARRANTY <span class="keyword">OF</span> <span class="keyword">ANY</span> KIND, EXPRESS <span class="keyword">OR</span></div><div class="line">IMPLIED, <span class="keyword">INCLUDING</span> BUT <span class="keyword">NOT</span> LIMITED <span class="keyword">TO</span> THE WARRANTIES <span class="keyword">OF</span> MERCHANTABILITY, FITNESS</div><div class="line"><span class="keyword">FOR</span> A PARTICULAR PURPOSE <span class="keyword">AND</span> NONINFRINGEMENT. <span class="keyword">IN</span> <span class="keyword">NO</span> <span class="keyword">EVENT</span> SHALL THE <span class="keyword">AUTHORS</span> <span class="keyword">OR</span></div><div class="line">COPYRIGHT HOLDERS BE LIABLE <span class="keyword">FOR</span> <span class="keyword">ANY</span> CLAIM, DAMAGES <span class="keyword">OR</span> OTHER LIABILITY, WHETHER</div><div class="line"><span class="keyword">IN</span> AN <span class="keyword">ACTION</span> <span class="keyword">OF</span> CONTRACT, TORT <span class="keyword">OR</span> OTHERWISE, ARISING <span class="keyword">FROM</span>, <span class="keyword">OUT</span> <span class="keyword">OF</span> <span class="keyword">OR</span> <span class="keyword">IN</span></div><div class="line"><span class="keyword">CONNECTION</span> <span class="keyword">WITH</span> THE SOFTWARE <span class="keyword">OR</span> THE <span class="keyword">USE</span> <span class="keyword">OR</span> OTHER DEALINGS <span class="keyword">IN</span> THE SOFTWARE.</div></pre></td></tr></table></figure>
<h3 id="添加公共文件"><a href="#添加公共文件" class="headerlink" title="添加公共文件"></a>添加公共文件</h3><p><strong><em>Pod{Assets,Classes} Classes 下放置别人可以pod下来的文件</em></strong></p>
<h3 id="添加DEMO"><a href="#添加DEMO" class="headerlink" title="添加DEMO"></a>添加DEMO</h3><p><strong><em>Demo必须是可编译通过的，而且需要引入公共文件</em></strong></p>
<p>到目前为止本地的目录结构以及文件如下：4个</p>
<img src="/2017/02/01/CocoaPods之制作篇/test-1.png" alt="test-1.png" title="">
<hr>
<p>到此为止准备工作已经完成</p>
<h3 id="pod验证"><a href="#pod验证" class="headerlink" title="pod验证"></a>pod验证</h3><p><strong>执行以下命令：</strong><br></p>
<ol>
<li>$ set the new version to 1.0.0<br></li>
<li>set the new tag to 1.0.0<br><br><code>这两条命令是为pod添加版本号并打上tag。然后执行pod验证命令：</code><br><br>$ pod lib lint<br><br>如果一切正常，这条命令执行完后会出现下面的输出：<br></li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"> <span class="selector-tag">-</span>&gt; <span class="selector-tag">WZMarqueeView</span> (1<span class="selector-class">.0</span><span class="selector-class">.0</span>)</div><div class="line"></div><div class="line"><span class="selector-tag">WZMarqueeView</span> <span class="selector-tag">passed</span> <span class="selector-tag">validation</span>.</div></pre></td></tr></table></figure>
<p><strong>如果失败可以 pod lib lint –no-clean   or    pod lib lint –no-clean –verbose  查看详细信息</strong></p>
<p>到此，pod验证就结束了。 需要说明的是，在执行pod验证命令的时候，打印出了任何warning或者error信息，验证都会失败！如果验证出现异常，打印的信息会很详细，大家可以根据对应提示做出修改。</p>
<h3 id="本地git仓库修改内容上传到github仓库"><a href="#本地git仓库修改内容上传到github仓库" class="headerlink" title="本地git仓库修改内容上传到github仓库"></a>本地git仓库修改内容上传到github仓库</h3><p>依次执行以下命令：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>git add -A &amp;&amp; git commit -m <span class="string">"Release 1.0.0."</span></div><div class="line"><span class="variable">$ </span>git tag <span class="string">'1.0.0'</span></div><div class="line"><span class="variable">$ </span>git push --tags</div><div class="line"><span class="variable">$ </span>git push origin master</div></pre></td></tr></table></figure>
<p><strong>上述命令均属git的范畴，这里不多述。如果一切正常，github上就应该能看到自己刚添加的内容了。如下图所示： </strong></p>
<img src="/2017/02/01/CocoaPods之制作篇/20140304200449389.jpg" alt="20140304200449389.jpg" title="">
<hr>
<p><strong>Pod search 到了吗？上传podspec文件到CocoaPods官方仓库中</strong></p>
<p>经过前边的四步操作，你可能以为已经结束了，不幸的是还早着呢。 要想一个Pods依赖库真正可用，还需要做最后一步操作，将我们刚才生成的podspec文件上传到CocoaPods官方的Specs仓库中，链接为：<a href="https://github.com/CocoaPods/Specs" target="_blank" rel="external">https://github.com/CocoaPods/Specs</a> 打开这个链接你就会发现，原来我们能使用的，以及我们使用pod search命令能搜索到的所有Pods依赖库都会把它们的podspec文件上传到这个仓库中，也就是说，只有将我们的podspec文件上传到这个仓库中以后，才能成为一个真正的Pods依赖库，别人才能正常使用！ 按照git的规则，要想向别人的仓库中添加文件，必须先fork一份别人的仓库，做完相应地修改后，在push给仓库的原作者，等到作者审核通过，然后合并到原来的仓库中。 流程明白了以后，自然知道该怎么干了：</p>
<h4 id="fork一份CocoaPods官方的Specs仓库"><a href="#fork一份CocoaPods官方的Specs仓库" class="headerlink" title="fork一份CocoaPods官方的Specs仓库"></a>fork一份CocoaPods官方的Specs仓库</h4><ul>
<li>进入到刚才的官方仓库链接中，点击屏幕右上角的fork按钮，如下图：</li>
</ul>
<img src="/2017/02/01/CocoaPods之制作篇/20140304200449390.jpg" alt="20140304200449390.jpg" title="">
<ul>
<li>然后大家会发现自己名下会多一份仓库的分支。比如我的分支为：</li>
</ul>
<img src="/2017/02/01/CocoaPods之制作篇/20140304200450394.jpg" alt="20140304200450394.jpg" title="">
<ul>
<li>fork一份CocoaPods官方的Specs仓库</li>
<li>将fork的仓库clone到本地</li>
<li>将自己的podspec文件添加到本地Specs仓库中</li>
<li>上传本地Specs仓库中的修改到github仓库</li>
<li>将在自己fork的Specs上做的修改pull给CocoaPods官方的Specs仓库</li>
<li>查看审核进度</li>
<li>查看我们自己创建的Pods依赖库</li>
</ul>
<h3 id="将fork的仓库clone到本地"><a href="#将fork的仓库clone到本地" class="headerlink" title="将fork的仓库clone到本地"></a>将fork的仓库clone到本地</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ git <span class="keyword">clone</span> <span class="title">https</span>://github.com/wangzz/Specs.git</div></pre></td></tr></table></figure>
<p><strong>注意，大家需要将对应的仓库地址换成自己的。 这个仓库有点大，需要有耐心啊</strong></p>
<h3 id="将自己的podspec文件添加到本地Specs仓库中"><a href="#将自己的podspec文件添加到本地Specs仓库中" class="headerlink" title="将自己的podspec文件添加到本地Specs仓库中"></a>将自己的podspec文件添加到本地Specs仓库中</h3><p>Specs仓库clone到本地后，会放到一个名为Specs的文件夹中。podspec文件在Specs仓库中的保存原则是： Pods依赖库同名文件夹—&gt;版本号同名文件夹—&gt;podspec文件 照此原则，我需要在Specs文件夹下建立一个名为WZMarqueeView的文件夹，然后进入到WZMarqueeView文件夹下，建立一个名称为1.0.0的文件夹，最后进入到1.0.0这个文件夹下，并且将之前创建好的WZMarqueeView.podspec文件拷贝进来。 不难理解，如果以后有对WZMarqueeView类的升级，就在WZMarqueeView文件夹下建立对应版本名称的文件夹，用于保存对应版本的podspec文件即可。 这些操作完成后，目录层次</p>
<p>结构如下所示</p>
<img src="/2017/02/01/CocoaPods之制作篇/20140304200450396.jpg" alt="20140304200450396.jpg" title="">
<h3 id="上传本地Specs仓库中的修改到github仓库"><a href="#上传本地Specs仓库中的修改到github仓库" class="headerlink" title="上传本地Specs仓库中的修改到github仓库"></a>上传本地Specs仓库中的修改到github仓库</h3><p>执行以下命令：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ git <span class="keyword">add</span><span class="bash"> -A &amp;&amp; git commit -m <span class="string">"Add WZMarqueeView podspec file"</span></span></div><div class="line">$ git push origin master</div></pre></td></tr></table></figure>
<p><strong>成功以后就能在github上自己fork的Specs仓库中看到刚上传的文件了。</strong></p>
<h3 id="将在自己fork的Specs上做的修改pull给CocoaPods官方的Specs仓库"><a href="#将在自己fork的Specs上做的修改pull给CocoaPods官方的Specs仓库" class="headerlink" title="将在自己fork的Specs上做的修改pull给CocoaPods官方的Specs仓库"></a>将在自己fork的Specs上做的修改pull给CocoaPods官方的Specs仓库</h3><ul>
<li>进入到自己fork的Specs仓库中，会看到屏幕左上角有一个绿色按钮：<img src="/2017/02/01/CocoaPods之制作篇/20140304200450398.jpg" alt="20140304200450398.jpg" title="">
</li>
</ul>
<img src="/2017/02/01/CocoaPods之制作篇/20140304200451400.jpg" alt="20140304200451400.jpg" title="">
<p>点击图中的绿色Create Pull Request按钮，即可将我们fork的Specs上做的修改pull给CocoaPods官方的Specs仓库。<br>到这一步后，剩下的工作就只有等了，等待CocoaPods的维护人员审核并将我们pull上去的修改合并到官方的Specs仓库中，这个过程通常会有一天左右的等待时间。如果有任何消息，比如审核不通过，或者审核通过了，CocoaPods官方都会发邮件通知的。 等到审核通过的时候，我们就能在官方的Specs仓库中看到自己上传的文件夹了。</p>
<h3 id="查看审核进度"><a href="#查看审核进度" class="headerlink" title="查看审核进度"></a>查看审核进度</h3><p>当然我们也能查看审核进度，打开这个链接：<a href="https://github.com/CocoaPods/Specs/pulls，这里能看到所有的Specs仓库pull请求，如下图：" target="_blank" rel="external">https://github.com/CocoaPods/Specs/pulls，这里能看到所有的Specs仓库pull请求，如下图：</a><br><img src="/2017/02/01/CocoaPods之制作篇/20140304200451402.jpg" alt="20140304200451402.jpg" title=""></p>
<p>红圈标识的就是我刚才pull上来的请求，点进去以后就能看到对应的审核进度。</p>
<h3 id="查看我们自己创建的Pods依赖库"><a href="#查看我们自己创建的Pods依赖库" class="headerlink" title="查看我们自己创建的Pods依赖库"></a>查看我们自己创建的Pods依赖库</h3><p>如果收到了CocoaPods官方发过来的审核通过邮件以后，你可能很着急的想在自己的电脑上执行pod search命令，看看能不能搜索到自己创建的Pods依赖库。不过你肯定会失望的，因为还需要执行一条命令才能在我们的本地电脑上使用search命令搜索到我们的依赖库：<br><br>pod setup <br>在我的CocoaPods系列教程中的第一篇：CocoaPods详解之—-进阶篇中的最后部分介绍过这条命令，它会将所有的Pods依赖库tree跟新到本地。执行完这条命令，再去执行:<br><br>pod search WZMarqueeView</p>
<p>就能显示出对应的介绍信息了！<br>说了那么多，到这里整个Pods依赖库创建过程才算真正结束！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/01/Podspec文件介绍/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="songjie">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/6276527?v=3&s=400">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="IT_金乌's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="IT_金乌's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/01/Podspec文件介绍/" itemprop="url">
                  Podspec文件介绍
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-01T21:55:14+08:00">
                2017-02-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/集成/" itemprop="url" rel="index">
                    <span itemprop="name">集成</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>Podspec或者Podspec.json用于初始化本地第三方库的Spec描述文件所有的spec文件存都存放在目录: <code>~/.cocoapods/repos/</code></strong></p>
<h3 id="格式描述"><a href="#格式描述" class="headerlink" title="格式描述"></a>格式描述</h3><h4 id="Podspec-Ruby格式"><a href="#Podspec-Ruby格式" class="headerlink" title="Podspec-Ruby格式"></a>Podspec-Ruby格式</h4><p>参考样例如下[xxxxxx.Podspec]:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">Pod::Spec.new <span class="keyword">do</span> <span class="params">|s|</span></div><div class="line">    s.name = <span class="string">'KeychainItemWrapper'</span></div><div class="line">    s.version = <span class="string">'1.0.0'</span></div><div class="line">    s.summary = <span class="string">'utils for keychain operating'</span></div><div class="line">    s.author = &#123; <span class="string">'antonyzhao'</span> =&gt; <span class="string">'antonyzhao@staff.joyme.com'</span> &#125;</div><div class="line">    s.source = &#123; <span class="symbol">:svn</span> =&gt; <span class="string">'http://svn.enjoyf.com/svn/ios/commonlib/KeychainItemWrapper'</span>, <span class="symbol">:tag</span> =&gt; <span class="string">'1.0.0'</span> &#125;</div><div class="line">    s.description = <span class="string">"utils for keychain operating"</span></div><div class="line">    s.platform = <span class="symbol">:ios</span></div><div class="line">    s.source_files = <span class="string">'*&#123;.h,.m&#125;'</span></div><div class="line">    s.frameworks = Security<span class="string">'</span></div><div class="line">end</div></pre></td></tr></table></figure></p>
<p><strong>注意:</strong></p>
<ol>
<li>s.name:该代码的名称，必须填写</li>
<li>s.version:这个描述文件所对应的版本</li>
<li>s.summary:该代码的描述信息</li>
<li>s.author:这份代码的作者</li>
<li>s.source:该代码的链接地址，参数如下:<br>svn :该代码的版本控制工具<b><br>tag :该代码需要checkout的tag</b></li>
<li>s.description:该代码的描述信息</li>
<li>s.platform:该代码所对应的可运行平台</li>
<li>s.source_files:该代码中所包括的源代码</li>
<li>s.frameworks:该代码所依赖的其他framework</li>
</ol>
<h4 id="Podspec-Json格式"><a href="#Podspec-Json格式" class="headerlink" title="Podspec-Json格式"></a>Podspec-Json格式</h4><p>参考样例如下[xxxxxx.Podspec.json]:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"name"</span>: <span class="string">"KeychainItemWrapper"</span>,</div><div class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</div><div class="line">  <span class="attr">"summary"</span>: <span class="string">"utils for keychain operating"</span>,</div><div class="line">  <span class="attr">"authors"</span>: &#123;</div><div class="line">    <span class="attr">"name"</span>: <span class="string">"jw007800@yeah.net"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"source"</span>: &#123;</div><div class="line">    <span class="attr">"svn"</span>: <span class="string">"http://svn.............."</span>,</div><div class="line">    <span class="attr">"tag"</span>: <span class="string">"1.0.0"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"requires_arc"</span>: <span class="literal">true</span>,</div><div class="line">  <span class="attr">"platforms"</span>: &#123;</div><div class="line">    <span class="attr">"ios"</span>: <span class="string">"6.0"</span>,</div><div class="line">    <span class="attr">"osx"</span>: <span class="string">"10.8"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"public_header_files"</span>: <span class="string">"*.h"</span>,</div><div class="line">  <span class="attr">"source_files"</span>: <span class="string">"*&#123;.h,.m&#125;"</span>,</div><div class="line">  <span class="attr">"frameworks"</span>: [</div><div class="line">    <span class="string">"Security"</span></div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>注意:</strong></p>
<ol>
<li>name: 该代码的名称，必须填写</li>
<li>version:该描述文件所对应的版本</li>
<li>summary:该代码所对应的描述信息</li>
<li>athors:该代码所对应的作者</li>
<li>source:该代码所对应的版本控制工具及该代码的tag，参数如下:<br>svn:代表该代码的版本控制工具为svn，可以是其他工具:git/cvs<br>tag:代表该代码所对应的tag</li>
<li>requires_arc:该代码是否需要在arc中运行</li>
<li>platforms：该代码可运行的平台，参数如下:<br>ios:7.0 : 代表该代码可运行在ios7.0及以上的平台<br>osx:10.8 : 代表该代码可运行在osx 10.8及以上的平台<br></li>
<li>public_header_files:该代码需要对外提供的公共头文件</li>
<li>source_files:该代码中所包括的源代码</li>
<li>frameworks:该代码中所依赖的其他framework</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/01/Podfile文件介绍/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="songjie">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/6276527?v=3&s=400">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="IT_金乌's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="IT_金乌's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/01/Podfile文件介绍/" itemprop="url">
                  Podfile文件介绍
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-01T21:54:45+08:00">
                2017-02-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/集成/" itemprop="url" rel="index">
                    <span itemprop="name">集成</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>简介</strong></p>
<blockquote>
<p>在每一个由xcode创建的项目中，都可以加入Podfile文件，之后可以由cocoapods来维护该项目所依赖的第三份代码<br><br>Podfile 文件指定了项目中的target所依赖的第三方库</p>
</blockquote>
<h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">platform :ios, <span class="string">'6.0'</span></div><div class="line"></div><div class="line">pod <span class="string">'KeychainItemWrapper'</span>, :<span class="function"><span class="params">svn</span> =&gt;</span> <span class="string">'http://svn.enjoyf.com/svn/ios/commonlib/KeychainItemWrapper'</span>, :<span class="function"><span class="params">tag</span> =&gt;</span> <span class="string">'1.0.0'</span></div><div class="line">pod <span class="string">'AFNetWorking'</span>, <span class="string">'~&gt; 4.1.4'</span></div></pre></td></tr></table></figure>
<p><strong>注意:</strong></p>
<ol>
<li>指定编译版本<br>svn :该代码的版本控制工具</li>
<li>添加依赖库<br>pod ‘KeychainItemWrapper’ 为添加依赖库KeychainItemWrapper<br>:svn =&gt; ‘http….wrapper’ 指定了该代码的版本控制工具及链接地址<br>:tag =&gt; ‘1.0.0’ 指定了需要添加的项目中的代码的tag</li>
<li>第二种添加的为github中指定版本的库<br>pod ‘AFNetWorking’ 为添加依赖库 AFNetWorking</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/01/IOS公共库发布形式/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="songjie">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/6276527?v=3&s=400">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="IT_金乌's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="IT_金乌's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/01/IOS公共库发布形式/" itemprop="url">
                  IOS公共库发布形式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-01T21:53:59+08:00">
                2017-02-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/集成/" itemprop="url" rel="index">
                    <span itemprop="name">集成</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>本章讲解怎么发布和维护一个公共库</p>
</blockquote>
<h3 id="版本规则"><a href="#版本规则" class="headerlink" title="版本规则"></a>版本规则</h3><p>&emsp;&emsp;首先在讲怎么发布公共库之前，先说一下对公共库版本的规则，因为公共库是需要不断的维护的，每有改动都需要有一个新的版本。那就问题来了，版本要有规则。</p>
<p>&emsp;&emsp;之前讲过 <a href="">移动端版本号注意事项</a>。 版本规则为:<code>MainVersion</code>.<code>SmallVersion</code>.<code>BuildVersion</code></p>
<ul>
<li>MainVersion:如果遇到较大代码变动，比如结构发生变动，则修改大版本号</li>
<li>SmallVersion:如果较少量代码变动，比如添加代码、修改代码等，则修改小版本号</li>
<li>BuildVersion:如果需要补充注释、修改名称等，则修改编译版本号<br>公共库中的代码初始版本为1.0.0</li>
</ul>
<p>公共库的目录最好放在SVN一个专门的文件夹下</p>
<h3 id="公共库依赖工具"><a href="#公共库依赖工具" class="headerlink" title="公共库依赖工具"></a>公共库依赖工具</h3><ul>
<li>cocoapods</li>
<li><a href="http://blog.csdn.net/muyu114/article/details/9454197" target="_blank" rel="external">生成doc文档</a></li>
</ul>
<h3 id="公共库依赖podspec文件介绍"><a href="#公共库依赖podspec文件介绍" class="headerlink" title="公共库依赖podspec文件介绍"></a>公共库依赖podspec文件介绍</h3><ul>
<li><a href="#">podspec文件介绍</a></li>
<li><a href="#">Podfile文件介绍</a></li>
</ul>
<h3 id="集成公共库步骤"><a href="#集成公共库步骤" class="headerlink" title="集成公共库步骤"></a>集成公共库步骤</h3><h4 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h4><ol>
<li>checkout <code>svnscript</code> 脚本</li>
<li>通过terminal，进入script目录，</li>
<li>执行shell 命令 ：<code>sh checkenv</code></li>
</ol>
<h4 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h4><ol>
<li>上述操作完成之后，会出现use [podinstall] or [podupdate] to update pod，此时注意</li>
<li>注意在项目的目录下执行 pod update<br><ul>
<li>集成cocoapods时，需要执行pod install或者pod update，而此时需要执行podinstall或者podupdate</li>
<li><code>podinstall</code>: 该操作用于初次建立Podfile文件，引入所依赖的库</li>
<li><code>podupdate</code>:该操作用于修改Podfile文件，更新所依赖的库</li>
</ul>
</li>
<li>由于appledoc的安装环境与osx版本和xcode版本有关，我在checkenv中注释掉了，有需要的可以自行开启，安装appledoc。</li>
</ol>
<p><code>appledoc可以根据在.h文件中添加的注释，自动生成doc文档，方便查看api.</code></p>
<h3 id="xcode集成cocoapods插件"><a href="#xcode集成cocoapods插件" class="headerlink" title="xcode集成cocoapods插件"></a>xcode集成cocoapods插件</h3><ol>
<li>可以安装cocoapods插件，通过该插件可以很方便的在xcode中管理Podfile文件</li>
<li>安装：<a href="http://mdsa.51cto.com/art/201509/492230.htm" target="_blank" rel="external">cocoapods-xcode-plugin</a></li>
</ol>
<h3 id="公共库项目开发"><a href="#公共库项目开发" class="headerlink" title="公共库项目开发"></a>公共库项目开发</h3><ol>
<li>进入需要创建commonlib的目录中，执行podlibcreate NAME,等待执行完毕</li>
<li>按照提示，打开执行的xcodeproj的文可</li>
<li>目录结构<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">├── <span class="keyword">tags</span></div><div class="line">└── trunk</div><div class="line">    ├── DEMO.podspec.json        <span class="keyword">p</span><span class="variable">s:</span> 为通过Pod集成时的代码描述文件</div><div class="line">    ├── Example                  <span class="keyword">p</span><span class="variable">s:</span> 测试的project</div><div class="line">    │   ├── DEMO                 <span class="keyword">p</span><span class="variable">s:</span></div><div class="line">    │   ├── DEMO.xcodeproj       <span class="keyword">p</span><span class="variable">s:</span></div><div class="line">    │   ├── Podfile              <span class="keyword">p</span><span class="variable">s:</span></div><div class="line">    │   └── Tests                <span class="keyword">p</span><span class="variable">s:</span></div><div class="line">    ├── LICENSE                  <span class="keyword">p</span><span class="variable">s:</span> 声明文件</div><div class="line">    ├── Pod                      <span class="keyword">p</span><span class="variable">s:</span></div><div class="line">    │   ├── Assets               <span class="keyword">p</span><span class="variable">s:</span> 为项目中需要引入的图片、等资源</div><div class="line">    │   └── Classes              <span class="keyword">p</span><span class="variable">s:</span> 为公共库代码(通过pod来引入的代码，非项目测试代码)</div><div class="line">    └── README.md                <span class="keyword">p</span><span class="variable">s:</span> 为公共库项目简介</div><div class="line"></div><div class="line"><span class="number">9</span> directories, <span class="number">4</span> <span class="keyword">files</span></div></pre></td></tr></table></figure>
</li>
</ol>
<p>如果想修改 Example 或者 目录结构 需要 在脚本中更换模板工程</p>
<h3 id="公共库版本更新维护"><a href="#公共库版本更新维护" class="headerlink" title="公共库版本更新维护"></a>公共库版本更新维护</h3><p><strong>流程</strong></p>
<ol>
<li>修改NAME.podspec.json中的版本号<br>version:指定的版本号<br>tag:同version的版本号</li>
<li>修改trunk代码</li>
<li>提交trunk代码</li>
<li>add tag<code>注意规范</code></li>
</ol>
<p><strong>注意</strong></p>
<ol>
<li>如果在项目开发过程中，需要扩展公共库内容，则可以采取以下流程</li>
<li>找到项目中Pods内需要修改的公共库代码，修改内容</li>
<li>跟随项目进行调试</li>
<li>调试没有问题，整理Pods中修改过的公共库代码</li>
<li>将Pods文件夹内修改过的公共库代码拷贝至该公共库中trunk目录，替换源文件</li>
<li>提交trunk代码</li>
<li>打tag</li>
<li>修改项目中Podfile文件，更新公共库代码</li>
</ol>
<h3 id="疑难杂症"><a href="#疑难杂症" class="headerlink" title="疑难杂症"></a>疑难杂症</h3><ul>
<li>在osx10.11 beta和xcode7beta中，如果执行podinstall或potupdate出现错误，建议更新pod至最新版，执行<code>sudo gem update</code></li>
<li>OS X10.11环境下执行sudo gem update 出现错误 “bad response Not Found 404 (<a href="http://ruby.taobao.org/latest_spe）”时，执行gem" target="_blank" rel="external">http://ruby.taobao.org/latest_spe）”时，执行gem</a> sources -a <a href="https://ruby.taobao.org/" target="_blank" rel="external">https://ruby.taobao.org/</a> ，再更新就好了。来源看<a href="http://blog.csdn.net/w_x_p/article/details/49151477/" target="_blank" rel="external">这里</a>。</li>
<li>有时候add tag 后 pod 完 发现没有发生变化，这个貌似是svn的一个bug（缓冲问题）。没找到好的办法，重新add个tag吧。</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/01/cocoapods/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="songjie">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/6276527?v=3&s=400">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="IT_金乌's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="IT_金乌's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/01/cocoapods/" itemprop="url">
                  cocoapods
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-01T21:50:51+08:00">
                2017-02-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/集成/" itemprop="url" rel="index">
                    <span itemprop="name">集成</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="CocoaPods是什么？"><a href="#CocoaPods是什么？" class="headerlink" title="CocoaPods是什么？"></a>CocoaPods是什么？</h3><p>当你开发iOS应用时，会经常使用到很多第三方开源类库，比如JSONKit，AFNetWorking等等。可能某个类库又用到其他类库，所以要使用它，必须得另外下载其他类库，而其他类库又用到其他类库，“子子孙孙无穷尽也”，这也许是比较特殊的情况。总之小编的意思就是，手动一个个去下载所需类库十分麻烦。另外一种常见情况是，你项目中用到的类库有更新，你必须得重新下载新版本，重新加入到项目中，十分麻烦。如果能有什么工具能解决这些恼人的问题，那将“善莫大焉”。所以，你需要 CocoaPods。</p>
<p>CocoaPods应该是iOS最常用最有名的类库管理工具了，上述两个烦人的问题，通过cocoaPods，只需要一行命令就可以完全解决，当然前提是你必须正确设置它。重要的是，绝大部分有名的开源类库，都支持CocoaPods。所以，作为iOS程序员的我们，掌握CocoaPods的使用是必不可少的基本技能了</p>
<p>对于CocoaPods还不太熟悉的，建议参考一下唐巧的博客或者直接到CocoaPods的官网看看：<a href="https://cocoapods.org/" target="_blank" rel="external">https://cocoapods.org/</a></p>
<h3 id="如何下载和安装CocoaPods？"><a href="#如何下载和安装CocoaPods？" class="headerlink" title="如何下载和安装CocoaPods？"></a>如何下载和安装CocoaPods？</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">function installPod() &#123;</div><div class="line">   echo <span class="string">'--install--cocoapods--'</span></div><div class="line">   sudo $&#123;GEM&#125; sources --remove <span class="symbol">https:</span>/<span class="regexp">/rubygems.org/</span></div><div class="line">   sudo $&#123;GEM&#125; sources -a <span class="symbol">http:</span>/<span class="regexp">/ruby.taobao.org/</span></div><div class="line">   echo <span class="string">'---this will also need a long time to finish this task---'</span></div><div class="line">   sudo $&#123;GEM&#125; install -VN xcodeproj</div><div class="line">   sudo $&#123;GEM&#125; install -VN cocoapods</div><div class="line">   echo <span class="string">'OK, pod has already installed on the computer'</span></div><div class="line">   echo <span class="string">'pod =&gt; version:'</span><span class="string">`$&#123;POD&#125; --version`</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="使用CocoaPods"><a href="#使用CocoaPods" class="headerlink" title="使用CocoaPods"></a>使用CocoaPods</h3><h4 id="创建Podfile"><a href="#创建Podfile" class="headerlink" title="创建Podfile"></a>创建Podfile</h4><a href="/2017/02/01/Podfile文件介绍/" title="Podfile文件介绍">Podfile文件介绍</a>
<h4 id="执行导入命令"><a href="#执行导入命令" class="headerlink" title="执行导入命令"></a>执行导入命令</h4><p><code>pod install</code></p>
<h3 id="pod-SVN-中的代码"><a href="#pod-SVN-中的代码" class="headerlink" title="pod SVN 中的代码"></a>pod SVN 中的代码</h3><p>在实际中大多数公司是采用svn作代码管理的，这样我们希望做一些公共库方便各个不同的项目之间快速集成、维护。相关公共库参考 <a href="/2017/02/01/IOS公共库发布形式/" title="IOS公共库发布形式">IOS公共库发布形式</a></p>
<h4 id="安装-cocoapods-repo-svn-插件"><a href="#安装-cocoapods-repo-svn-插件" class="headerlink" title="安装 cocoapods-repo-svn 插件"></a>安装 cocoapods-repo-svn 插件</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">function installPodSvn() &#123;</div><div class="line">    echo <span class="string">'--install--pod--svn--plugin--'</span></div><div class="line">    echo <span class="string">'--need---to---enter--your---root--password--'</span></div><div class="line">    repoSvn=<span class="string">`pod | grep repo-svn`</span></div><div class="line">    <span class="keyword">if</span> [[ -z $&#123;repoSvn&#125; ]]; <span class="keyword">then</span></div><div class="line">        sudo $&#123;GEM&#125; install -VN cocoapods-repo-svn</div><div class="line">    <span class="keyword">else</span></div><div class="line">        echo <span class="string">'--already--install--[cocoapods-repo-svn]--'</span></div><div class="line">    fi</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>svn中代码目录结构如下：</p>
<img src="/2017/02/01/cocoapods/svn.png" alt="svn.png" title="">

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/01/NSURLProtocol介绍/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="songjie">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/6276527?v=3&s=400">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="IT_金乌's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="IT_金乌's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/01/NSURLProtocol介绍/" itemprop="url">
                  NSURLProtocol介绍
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-01T19:20:16+08:00">
                2017-02-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/IOS/" itemprop="url" rel="index">
                    <span itemprop="name">IOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>枯藤老树昏鸦小桥流水人家~~ 好湿 ``好湿</p>
</blockquote>
<h4 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a><font color="#8FBC8F"><strong><em>使用场景</em></strong></font><br></h4><ol>
<li><a href="#重定向网络请求">重定向网络请求</a></li>
<li><a href="#忽略网络请求，使用本地缓存">忽略网络请求，使用本地缓存</a></li>
<li><a href="#creat ProjectTemplate">自定义网络请求的返回结果</a></li>
<li><a href="#creat LibTemplate">一些全局的网络请求设置</a></li>
</ol>
<hr>
<h4 id="NSURLProtocol-定义"><a href="#NSURLProtocol-定义" class="headerlink" title="NSURLProtocol 定义"></a>NSURLProtocol 定义</h4><p>&emsp;&emsp;NSURLProtocol能够让你去重新定义苹果的<a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/URLLoadingSystem/URLLoadingSystem.html#//apple_ref/doc/uid/10000165-BCICJDHA" target="_blank" rel="external">URL加载系统</a> (URL Loading System)的行为，URL Loading System里有许多类用于处理URL请求，比如NSURL，NSURLRequest，NSURLConnection和NSURLSession等，当URL Loading System使用NSURLRequest去获取资源的时候，它会创建一个NSURLProtocol子类的实例，你不应该直接实例化一个NSURLProtocol，NSURLProtocol看起来像是一个协议，但其实这是一个类，而且必须使用该类的子类，并且需要被注册。</p>
<h4 id="重定向网络请求"><a href="#重定向网络请求" class="headerlink" title="重定向网络请求"></a><span id="重定向网络请求">重定向网络请求</span></h4><p>&emsp;&emsp;最近在项目里由于电信那边发生dns发生域名劫持，因此需要手动将URL请求的域名重定向到指定的IP地址，但是由于请求可能是通过NSURLConnection,NSURLSession或者AFNetworking等方式，因此要想统一进行处理，一开始是想通过Method Swizzling去hook cfnetworking底层方法，后来发现其实有个更好的方法–NSURLProtocol。</p>
<h5 id="实现方法"><a href="#实现方法" class="headerlink" title="实现方法"></a>实现方法</h5><p><strong>拦截网络请求</strong></p>
<h4 id="子类化NSURLProtocol并注册"><a href="#子类化NSURLProtocol并注册" class="headerlink" title="子类化NSURLProtocol并注册"></a>子类化NSURLProtocol并注册</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@interface EFURLProtocol : NSURLProtocol</div></pre></td></tr></table></figure>
<p>然后在application:didFinishLaunchingWithOptions:方法中注册该CustomURLProtocol，一旦注册完毕后，它就有机会来处理所有交付给URL Loading system的网络请求。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions &#123;</div><div class="line">    //注册protocol</div><div class="line">    [NSURLProtocol registerClass:[CustomURLProtocol class]];</div><div class="line">    return YES;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="现在可以开始实现NSURLProtocol的一些方法："><a href="#现在可以开始实现NSURLProtocol的一些方法：" class="headerlink" title="现在可以开始实现NSURLProtocol的一些方法："></a>现在可以开始实现NSURLProtocol的一些方法：</h5><blockquote>
<p><a href="#">canInitWithRequest</a></p>
</blockquote>
<p>这个方法主要是说明你是否打算处理对应的request，如果不打算处理，返回NO,如果打算处理，返回YES，然后你就需要处理该请求的所有东西,网络数据可以简单的通过NSURLConnection去获取，而且每个NSURLProtocol对象都有一个NSURLProtocolClient实例，可以通过该client将获取到的数据返回给URL Loading System。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">+ (BOOL)canInitWithRequest:(NSURLRequest *)request &#123;</div><div class="line">    if ([self enabledParamSettingInSite:request.URL.absoluteString]) &#123;</div><div class="line">    //看看是否已经处理过了，防止无限循环</div><div class="line">        if ([NSURLProtocol propertyForKey:kEFURLProtocolKey inRequest:request]) &#123;</div><div class="line">            return NO;</div><div class="line">        &#125;else&#123;</div><div class="line">            return YES;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return NO;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong><a href="#">canonicalRequestForRequest</a></strong></p>
<p>通常该方法你可以简单的直接返回request，但也可以在这里修改request，比如添加header，修改host等，并返回一个新的request，这是一个抽象方法，子类必须实现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">+ (NSURLRequest *) canonicalRequestForRequest:(NSURLRequest *)request &#123;</div><div class="line">    NSMutableURLRequest *mutableReqeust = [request mutableCopy];</div><div class="line">    mutableReqeust = [self redirectHostInRequset:mutableReqeust];</div><div class="line">    return mutableReqeust;</div><div class="line">&#125;</div><div class="line"></div><div class="line">+(NSMutableURLRequest*)redirectHostInRequset:(NSMutableURLRequest*)request</div><div class="line">&#123;</div><div class="line">    if ([request.URL host].length == 0) &#123;</div><div class="line">        return request;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    NSString *originUrlString = [request.URL absoluteString];</div><div class="line">    NSString *originHostString = [request.URL host];</div><div class="line">    NSRange hostRange = [originUrlString rangeOfString:originHostString];</div><div class="line">    if (hostRange.location == NSNotFound) &#123;</div><div class="line">        return request;</div><div class="line">    &#125;</div><div class="line">    //定向到bing搜索主页</div><div class="line">    NSString *ip = @&quot;cn.bing.com&quot;;</div><div class="line"></div><div class="line">    // 替换域名</div><div class="line">    NSString *urlString = [originUrlString stringByReplacingCharactersInRange:hostRange withString:ip];</div><div class="line">    NSURL *url = [NSURL URLWithString:urlString];</div><div class="line">    request.URL = url;</div><div class="line"></div><div class="line">    return request;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p><a href="#">requestIsCacheEquivalent</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">+ (BOOL)requestIsCacheEquivalent:(NSURLRequest *)a toRequest:(NSURLRequest *)b</div><div class="line">&#123;</div><div class="line">    return [super requestIsCacheEquivalent:a toRequest:b];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p><a href="#">-startLoading</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- (void)startLoading</div><div class="line">&#123;</div><div class="line">    NSMutableURLRequest *mutableReqeust = [[self request] mutableCopy];</div><div class="line">    //标示改request已经处理过了，防止无限循环</div><div class="line">    [NSURLProtocol setProperty:@YES forKey:URLProtocolHandledKey inRequest:mutableReqeust];</div><div class="line">    self.connection = [NSURLConnection connectionWithRequest:mutableReqeust delegate:self];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p><a href="#">-stopLoading</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (void)stopLoading</div><div class="line">&#123;</div><div class="line">    [self.connection cancel];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="NSURLConnectionDataDelegate方法"><a href="#NSURLConnectionDataDelegate方法" class="headerlink" title="NSURLConnectionDataDelegate方法"></a>NSURLConnectionDataDelegate方法</h5><p>在处理网络请求的时候会调用到该代理方法，我们需要将收到的消息通过client返回给URL Loading System。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">- (void) connection:(NSURLConnection *)connection didReceiveResponse:(NSURLResponse *)response &#123;</div><div class="line">    [self.client URLProtocol:self didReceiveResponse:response cacheStoragePolicy:NSURLCacheStorageNotAllowed];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void) connection:(NSURLConnection *)connection didReceiveData:(NSData *)data &#123;</div><div class="line">    [self.client URLProtocol:self didLoadData:data];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void) connectionDidFinishLoading:(NSURLConnection *)connection &#123;</div><div class="line">    [self.client URLProtocolDidFinishLoading:self];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)connection:(NSURLConnection *)connection didFailWithError:(NSError *)error &#123;</div><div class="line">    [self.client URLProtocol:self didFailWithError:error];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="忽略网络请求，使用本地缓存"><a href="#忽略网络请求，使用本地缓存" class="headerlink" title="忽略网络请求，使用本地缓存"></a><span id="忽略网络请求，使用本地缓存">忽略网络请求，使用本地缓存</span></h4><p>参考<a href="#">小端攻略库</a>的离线缓存</p>
<h4 id="自定义网络请求的返回结果"><a href="#自定义网络请求的返回结果" class="headerlink" title="自定义网络请求的返回结果"></a><span id="自定义网络请求的返回结果">自定义网络请求的返回结果</span></h4><h4 id="一些全局的网络请求设置"><a href="#一些全局的网络请求设置" class="headerlink" title="一些全局的网络请求设置"></a><span id="一些全局的网络请求设置">一些全局的网络请求设置</span></h4><p>指对你需要简析的域名做处理。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/01/关于IOS中的cookie/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="songjie">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/6276527?v=3&s=400">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="IT_金乌's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="IT_金乌's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/01/关于IOS中的cookie/" itemprop="url">
                  关于IOS中的cookie
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-01T18:28:45+08:00">
                2017-02-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/me/" itemprop="url" rel="index">
                    <span itemprop="name">me</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="cookie简介"><a href="#cookie简介" class="headerlink" title="cookie简介"></a>cookie简介</h3><p>Cookie是在客户端存储服务器状态的一种机制,Web服务器可以通过Set-Cookie或者Set-Cookie2 HTTP头部设置Cookie。<br>Cookie可以分为两类，会话Cookie和持久Cookie,会话Cookie是临时Cookie,当前会话结束(浏览器退出)时Cookie会被删除。持久Cookie会存储在用户的硬盘上,浏览器退出，然后重新启动后Cookie仍然存在。会话Cookie和持久Cookie的区别在于过期时间，如果设置了Discard参数(Cookie 版本1)或者没有设置Expires(Cookie版本0)或Max-Age(Cookie版本1)设置过期时间，则此Cookie为会话Cookie<br>Cookie有两个版本,一个是版本0(Netscape Cookies)和版本1(RFC 2965),目前大多数服务器使用的Cookie 0。<br>有关Cookie的详细内容请参考<a href="http://dl.vmall.com/c0ldb5894p" target="_blank" rel="external">《HTTP权威指南》</a>的相关章节。</p>
<h3 id="NSHTTPCookie"><a href="#NSHTTPCookie" class="headerlink" title="NSHTTPCookie"></a>NSHTTPCookie</h3><p>在iOS中使用<a href="https://developer.apple.com/reference/foundation/nshttpcookie" target="_blank" rel="external">NSHTTPCookie</a>类封装一条cookie,通过NSHTTPCookie的方法读取到cookie的通用属性。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- (NSUInteger)version;</div><div class="line">- (NSString *)name;</div><div class="line">- (NSString *)value;</div><div class="line">- (NSString *)domain;</div><div class="line">- (NSString *)path;</div><div class="line">- (BOOL)isSessionOnly;</div><div class="line">....</div></pre></td></tr></table></figure></p>
<p>可以通过手工赋值的方式创建Cookie,如<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">+ (id)cookieWithProperties:(NSDictionary *)properties;</div><div class="line">- (id)initWithProperties:(NSDictionary *)properties;</div></pre></td></tr></table></figure></p>
<p>也可以从Cookie中读取到所有属性。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (NSDictionary *)properties;</div></pre></td></tr></table></figure></p>
<p>使用NSHTTPCookie的类方法可以将NSHTTPCookie实例与HTTP cookie header相互转换.<br>根据NSHTTPCookie实例数组生成对应的HTTP cookie header<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">+ (NSDictionary *)requestHeaderFieldsWithCookies:(NSArray *)cookies;</div></pre></td></tr></table></figure></p>
<p>从headerFileds中读取到Cookie相关内容,生成NSHTTPCookie实例对象数组。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">+ (NSArray *)cookiesWithResponseHeaderFields:(NSDictionary *)headerFields forURL:(NSURL *)theURL;</div></pre></td></tr></table></figure>
<p>该方法会忽略headerFileds中与cookie无关的字段，如果headerFileds中的cookie没有指定domain,则使用theURL的domain,如果没有指定path,则使用”/”.</p>
<p>除非NSURLRequest明确指定不使用cookie(<code>HTTPShouldHandleCookies</code>设为NO),否则URL loading system会自动为NSURLRequest发送合适的存储cookie。从NSURLResponse返回的cookie也会根据当前的cookie访问策略(cookie acceptance policy)接收到系统中。</p>
<h3 id="NSHTTPCookieStorage"><a href="#NSHTTPCookieStorage" class="headerlink" title="NSHTTPCookieStorage"></a>NSHTTPCookieStorage</h3><p><a href="">NSHTTPCookieStorage</a>单件类提供了管理所有NSHTTPCookie对象的接口，在OS X里,cookie是在所有程序中共享的，而在iOS中,cookie只当当前应用中有效。</p>
<p>通过sharedHTTPCookieStorage方法可获取到共享的NSHTTPCookieStorage单件对象。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">+ (NSHTTPCookieStorage *)sharedHTTPCookieStorage；</div></pre></td></tr></table></figure></p>
<p>使用NSHTTPCookieStorage单件对象可获取到当前存储的所有cookie<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (NSArray *)cookies</div></pre></td></tr></table></figure></p>
<p>或针对特定URL的cookie</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (NSArray *)cookiesForURL:(NSURL *)theURL;</div></pre></td></tr></table></figure>
<p>还可以添加/删除Cookie</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">– deleteCookie:</div><div class="line">– setCookie:</div><div class="line">– setCookies:forURL:mainDocumentURL:</div></pre></td></tr></table></figure>
<p>通过NSHTTPCookieStorage可读取/修改cookie接收策略,默认为<code>NSHTTPCookieAcceptPolicyAlways</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">- (NSHTTPCookieAcceptPolicy)cookieAcceptPolicy；</div><div class="line">- (void)setCookieAcceptPolicy:(NSHTTPCookieAcceptPolicy)aPolicy.</div></pre></td></tr></table></figure>
<p>一共有三种cookie accept policy,</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">typedef enum &#123;</div><div class="line">   NSHTTPCookieAcceptPolicyAlways,</div><div class="line">   NSHTTPCookieAcceptPolicyNever,</div><div class="line">   NSHTTPCookieAcceptPolicyOnlyFromMainDocumentDomain</div><div class="line">&#125; NSHTTPCookieAcceptPolicy;</div></pre></td></tr></table></figure>
<p><code>NSHTTPCookieAcceptPolicyAlways</code>:接收所有cookie,默认策略.<br><code>NSHTTPCookieAcceptPoicyNever</code>: 拒绝所有cookie<br><code>NSHTTPCookieAcceptPolicyOnlyFromMainDocumentDomain</code>:只接收main document domain中的cookie.</p>
<h3 id="Notification"><a href="#Notification" class="headerlink" title="Notification"></a>Notification</h3><p><code>NSHTTPCookieManagerCookiesChangedNotification</code></p>
<p>当NSHTTPCookieStorage实例中的cookies变化时发出此通知。</p>
<p><code>NSHTTPCookieManagerAcceptPolicyChangedNotification</code></p>
<p>当NSHTTPCookieStorage实例的cookie acceptance policy变化时发出此通知。</p>
<h3 id="Demo实现"><a href="#Demo实现" class="headerlink" title="Demo实现"></a>Demo实现</h3><p>保存cookie （先将cookie归档为data）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (void)saveCookies&#123;</div><div class="line">    NSData *cookies = [NSKeyedArchiver archivedDataWithRootObject:</div><div class="line">            [NSHTTPCookieStorage sharedHTTPCookieStorage].cookies];</div><div class="line">    [[NSUserDefaults standardUserDefaults] setObject:cookies forKey:@&quot;savedCookie&quot;];</div><div class="line">    [[NSUserDefaults standardUserDefaults] synchronize];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>设定指定的cookie（解档）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (void)reloadStoredCookies&#123;</div><div class="line">  NSArray *cookies = [NSKeyedUnarchiver unarchiveObjectWithData:</div><div class="line">                       [[NSUserDefaults standardUserDefaults]</div><div class="line">                                                 objectForKey:</div><div class="line">                      @&quot;savedC&quot;]</div><div class="line">  NSHTTPCookieStorage *cookieStorage = [NSHTTPCookieStorage sharedHTTPCookieStorage];</div><div class="line">  for (NSHTTPCookie *cookie in cookies) &#123;</div><div class="line">      [cookieStorage setCookie:cookie];</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>cookie中Value保存的内容均为NSString类型，如果为其它类型无法生成cookie对象</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/01/常用的地址收藏/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="songjie">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/6276527?v=3&s=400">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="IT_金乌's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="IT_金乌's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/01/常用的地址收藏/" itemprop="url">
                  常用的地址收藏
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-01T18:09:53+08:00">
                2017-02-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/IOS/" itemprop="url" rel="index">
                    <span itemprop="name">IOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://itunesconnect.apple.com" target="_blank" rel="external">苹果创建应用</a><br><a href="https://developer.apple.com/membercenter/index.action" target="_blank" rel="external">创建签名证书</a><br><a href="http://dev.umeng.com/push/ios/license-configuration-guide" target="_blank" rel="external">创建友盟推送证书</a><br><a href="https://itunes.apple.com/lookup?id=#id#" target="_blank" rel="external">根据itunesid获取app信息</a><br><a href="https://www.cocoacontrols.com" target="_blank" rel="external">UI CocoaControls</a><br><a href="http://codepen.io" target="_blank" rel="external">在线练习html、css及js</a><br>持续更新，记录有意思的网址</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/01/移动版本号注意事项/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="songjie">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/6276527?v=3&s=400">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="IT_金乌's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="IT_金乌's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/01/移动版本号注意事项/" itemprop="url">
                  移动版本号注意事项
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-01T16:48:09+08:00">
                2017-02-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/IOS/" itemprop="url" rel="index">
                    <span itemprop="name">IOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>移动端版本号注意事项</p>
</blockquote>
<h3 id="版本号描述"><a href="#版本号描述" class="headerlink" title="版本号描述"></a>版本号描述</h3><p>版本号规则为：A.B.C.D</p>
<p>A代表重大修改的版本，如实现新的功能或重大变化的修订。</p>
<p>B表示的修订，实现较突出的特点。</p>
<p>C代表维护版本。</p>
<p>D代表TD内部的build版本。</p>
<p>以上版本号，对外只显示A.B.C，</p>
<p>通过七牛部署安装时，需要显示的版本号为A.B.C.D</p>
<h3 id="服务器端检测规则"><a href="#服务器端检测规则" class="headerlink" title="服务器端检测规则"></a>服务器端检测规则</h3><p>服务器端版本检测规则不变，客户端只会上报A.B.C</p>
<h3 id="客户端处理规则"><a href="#客户端处理规则" class="headerlink" title="客户端处理规则"></a>客户端处理规则</h3><h4 id="Android版本号处理规则"><a href="#Android版本号处理规则" class="headerlink" title="Android版本号处理规则"></a>Android版本号处理规则</h4><p>以下内容是第一版，主要Android版本升级和现在的问题进行说明，确认后我会更新</p>
<p>Android端在manifest配置文件中存在两个版本号,</p>
<p>VersionCode：数据类型为Long，标识应用程序的发布版本号。该版本号主要用于版本升级判断，应用市场一般用此作为是否有新版本的判断条件。</p>
<p>VersionName：数据类型为String，标识用户能够看到的自定义版本号。该值主要用户用于显示，一般不作为应用是否有新版本的判断条件</p>
<p>VersionName默认构成为”A.B.C&lt;.D&gt;”,详细解释见 对VersionName的说明</p>
<p>第一个数代表重大修改的版本，如实现新的功能或重大变化的修订。</p>
<p>第二个数表示的修订，实现较突出的特点。</p>
<p>第三个数代表维护版本。</p>
<p>第四个数，如果存在代表测试时的Build版本，仅作为标识测试版本的递进，不做它用，在正式版本发布时会去掉。</p>
<p>客户端只上报VersionName作为版本标识（上报VersionCode是更好的做法，见对Android版本升级的说明)</p>
<p>Android端VersionName和VersionCode对应关系</p>
<p>例， VersionName为2.3.11，对应VersionCode 为 20311</p>
<p>例， VersionName为1.0.11，对应VersionCode 为 10011</p>
<p>对VersionName的说明</p>
<p>默认由”.”分隔的3位或者4位数字：A.B.C&lt;.D&gt;</p>
<p>正式版：A.B.C</p>
<p>Build版：D</p>
<p>A代表最大版本，</p>
<p>B代表较大需求变动，</p>
<p>C代表普通需求变动，</p>
<p>D代表测试期间的build版本，正式版本是不存在的。</p>
<p>对Android版本升级的说明</p>
<p>现在服务器和Android客户端检查更新使用VersionName是不太合适的，Android端版本更新检测应该仅判断VersionCode(现在应用市场版本升级的判断方式)，而不是VersionName。这个是历史遗留问题。</p>
<p>是否由“项目”开始予以纠正，以VersionCode值作为版本更新判断条件，VersionName作为UI显示。</p>
<h4 id="iOS端版本号处理规则"><a href="#iOS端版本号处理规则" class="headerlink" title="iOS端版本号处理规则"></a>iOS端版本号处理规则</h4><p>在Info.plist中，添加自定义项：DailyBuildVersion，数据为${CURRENT_PROJECT_VERSION}</p>
<p>在Build.setting中，设置Versioning System为Apple Generic</p>
<p>CFBundleShortVersionString:</p>
<p>默认三位数字：A.B.C</p>
<p>CFBundleVersion:</p>
<p>默认为三维数字：A.B.C同CFBundleShortVersionString</p>
<p>DailyBuildVersion:</p>
<p>${CURRENT_PROJECT_VERSION}</p>
<p>对于目前iOS端项目而言，</p>
<p>A代表最大版本，</p>
<p>B代表较大需求变动，</p>
<p>C代表普通需求变动，</p>
<p>D代表企业版1-2天得build版本。</p>
<p>我们客户端在上报版本时上报 CFBundleShortVersionString CFBundleVersion，D只是企业版中在“关于”显示的build版本<br>20150211 iOS 设置版本号</p>
<p>PO和PD如何确定版本号</p>
<p>默认初始版本为1.0.0</p>
<p>小的需求变动提升1.0.C中得C</p>
<p>较大需求变动提升1.B.0中得B</p>
<p>大版本需求变动提升A.0.0中得A</p>
<p>对外下载链接<br>为了能统计不同推广来源，所以结合talkingdata 和内部提供的跳转地址来管理 标准发布下载链接流程:<br>…..</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://avatars3.githubusercontent.com/u/6276527?v=3&s=400"
               alt="songjie" />
          <p class="site-author-name" itemprop="name">songjie</p>
          <p class="site-description motion-element" itemprop="description">Blog - 宋杰的实验室</p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">21</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/jw007800" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://jianshu.io/p/q81RER" target="_blank" title="Others">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Others
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.zhihu.com/people/your-user-name" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  知乎
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.cocoacontrols.com" target="_blank" title="CocoaControls">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  CocoaControls
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://codepen.io" target="_blank" title="在线练习html、css及js">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  在线练习html、css及js
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://example.com/" title="Title" target="_blank">Title</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">songjie</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  




  
  

  

  

  

  


</body>
</html>
